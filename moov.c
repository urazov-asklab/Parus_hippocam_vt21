//moov.c

#include "moov.h"

u8 qta_ftyp[32] = {
	0x00,0x00,0x00,0x20, /* ftyp size */
	 'f', 't', 'y', 'p', /* "ftyp" */
	 'q', 't', ' ', ' ', /* "qt  " */										// without this QT doesn't want to open audio
	0x00,0x00,0x00,0x01, /* ftyp QTFF specification date */
	 'i', 's', 'o', 'm', /* "isom" */ 										// list of compatible brands
	 'i', 's', 'o', '2', /* "iso2" */
	 'm', 'p', '4', '1', /* "mp41" */
	 'a', 'v', 'c', '1', /* "avc1" */
};

u8 qta_mdat[8] = {
	0x00,0x00,0x00,0x00,/* size */											// +will be filled later in code
	0x6D,0x64,0x61,0x74 /* "mdat" */
};

u8 qta_moov[116] = {
	0x00,0x00,0x00,0x00, /* moov size */  									// +will be filled later in code
	0x6D,0x6F,0x6F,0x76, /* "moov" */

	0x00,0x00,0x00,0x6C, /* mvhd size */
	0x6D,0x76,0x68,0x64, /* "mvhd" */
	0x00,0x00,0x00,0x00, /* mvhd flags */
	0xCE,0xE9,0x0B,0x00, /* mvhd creation time = 01.01.2014 00:00:00 */		// +will be updated later in code
	0xCE,0xE9,0x0B,0x00, /* mvhd modification time = 01.01.2014 00:00:00 */ // +will be updated later in code
	0x00,0x00,0x02,0x58, /* mvhd timescale = 600*/
	0x00,0x00,0x00,0x00, /* mvhd duration */								// +will be filled later in code
	0x00,0x01,0x00,0x00, /* mvhd preferred rate */
	0x01,0x00,0x00,0x00, /* mvhd preferred volume + reserve*/
	0x00,0x00,0x00,0x00, /* mvhd reserved */
	0x00,0x00,0x00,0x00, /* mvhd reserved */
	0x00,0x01,0x00,0x00, /* mvhd matrix a */
	0x00,0x00,0x00,0x00, /* mvhd matrix b */
	0x00,0x00,0x00,0x00, /* mvhd matrix u */
	0x00,0x00,0x00,0x00, /* mvhd matrix c */
	0x00,0x01,0x00,0x00, /* mvhd matrix d */
	0x00,0x00,0x00,0x00, /* mvhd matrix v */
	0x00,0x00,0x00,0x00, /* mvhd matrix x */
	0x00,0x00,0x00,0x00, /* mvhd matrix y */
	0x40,0x00,0x00,0x00, /* mvhd matrix w */
	0x00,0x00,0x00,0x00, /* mvhd preview time */
	0x00,0x00,0x00,0x00, /* mvhd preview duration */
	0x00,0x00,0x00,0x00, /* mvhd poster time */
	0x00,0x00,0x00,0x00, /* mvhd selection time */
	0x00,0x00,0x00,0x00, /* mvhd selection duration */
	0x00,0x00,0x00,0x00, /* mvhd current time */
	0x00,0x00,0x00,0x03, /* mvhd next track ID */
};

u8  qta_vt[312] = {
	0x00,0x00,0x00,0x00, /* trak size */ 									// +will be filled later in code
	0x74,0x72,0x61,0x6B, /* "trak" */

	0x00,0x00,0x00,0x5C, /* tkhd size */
	0x74,0x6B,0x68,0x64, /* "tkhd" */
	0x00,0x00,0x00,0x0F, /* tkhd flags */
	0xCE,0xE9,0x0B,0x00, /* tkhd creation time = 01.01.2014 00:00:00 */		// +will be updated later in code
	0xCE,0xE9,0x0B,0x00, /* tkhd modification time = 01.01.2014 00:00:00 */	// +will be updated later in code
	0x00,0x00,0x00,0x01, /* tkhd track ID */
	0x00,0x00,0x00,0x00, /* tkhd reserved */
	0x00,0x00,0x00,0x00, /* tkhd duration */								// +will be filled later in code
	0x00,0x00,0x00,0x00, /* tkhd reserved */
	0x00,0x00,0x00,0x00, /* tkhd reserved */
	0x00,0x00,0x00,0x00, /* tkhd layer & alternate group */
	0x00,0x00,0x00,0x00, /* tkhd volume & reserved */
	0x00,0x01,0x00,0x00, /* tkhd matrix a */
	0x00,0x00,0x00,0x00, /* tkhd matrix b */
	0x00,0x00,0x00,0x00, /* tkhd matrix u */
	0x00,0x00,0x00,0x00, /* tkhd matrix c */
	0x00,0x01,0x00,0x00, /* tkhd matrix d */
	0x00,0x00,0x00,0x00, /* tkhd matrix v */
	0x00,0x00,0x00,0x00, /* tkhd matrix x */
	0x00,0x00,0x00,0x00, /* tkhd matrix y */
	0x40,0x00,0x00,0x00, /* tkhd matrix w */
#if (FRAME_CROP_WIDTH == 704)
	0x02,0xC0,0x00,0x00, /* tkhd width = 704 => 0x02,0xC0,0x00,0x00*/
#else
	0x02,0xD0,0x00,0x00, /* tkhd width = 720 => 0x02,0xD0,0x00,0x00*/
#endif
	0x02,0x40,0x00,0x00, /* tkhd height = 576*/
	0x00,0x00,0x00,0x00, /* mdia size */  									// +will be filled later in code
	0x6D,0x64,0x69,0x61, /* "mdia" */

	0x00,0x00,0x00,0x20, /* mdhd size */
	0x6D,0x64,0x68,0x64, /* "mdhd" */
	0x00,0x00,0x00,0x00, /* mdhd flags */
	0xCE,0xE9,0x0B,0x00, /* mdhd creation time = 01.01.2014 00:00:00 */		// +will be updated later in code
	0xCE,0xE9,0x0B,0x00, /* mdhd modification time = 01.01.2014 00:00:00 */ // +will be updated later in code
	0x00,0x00,0x02,0x58, /* mdhd time scale = 600 */
	0x00,0x00,0x00,0x00, /* mdhd duration */								// +will be filled later in code
	0x00,0x00,0x00,0x00, /* mdhd language & quality */

	0x00,0x00,0x00,0x30, /* hdlr size */
	0x68,0x64,0x6C,0x72, /* "hdlr" */
	0x00,0x00,0x00,0x00, /* hdlr flags */
	0x6D,0x68,0x6C,0x72, /* hdlr component Type = "mhlr" */
	0x76,0x69,0x64,0x65, /* hdlr component Subtype = "vide" */
	0x00,0x00,0x00,0x00, /* hdlr component Manufacturer */
	0x00,0x00,0x00,0x00, /* hdlr component Flags */
	0x00,0x00,0x00,0x00, /* hdlr component Flags Mask */
	0x0F,0x56,0x69,0x64, /* hdlr component Name = $0F"VideoHandler "*/
	0x65,0x6F,0x48,0x61,
	0x6E,0x64,0x6C,0x65,
	0x72,0x20,0x20,0x20,

	0x00,0x00,0x00,0x00, /* minf size */ 									// +will be filled later in code
	0x6D,0x69,0x6E,0x66, /* "minf" */

	0x00,0x00,0x00,0x14, /* vmhd size */
	0x76,0x6D,0x68,0x64, /* "vmhd" */
	0x00,0x00,0x00,0x01, /* vmhd flags */
	0x00,0x00,0x00,0x00, /* vmhd graphics mode & opcolor */
	0x00,0x00,0x00,0x00, /* vmhd opcolor */

	0x00,0x00,0x00,0x24, /* dinf size */
	0x64,0x69,0x6E,0x66, /* "dinf" */
	0x00,0x00,0x00,0x1C, /* dref size */
	0x64,0x72,0x65,0x66, /* "dref" */
	0x00,0x00,0x00,0x00, /* dref flags */
	0x00,0x00,0x00,0x01, /* dref number of entries */
	0x00,0x00,0x00,0x0C, /* size */
	0x61,0x6C,0x69,0x73, /* "alis" */
	0x00,0x00,0x00,0x01, /* flags */

	0x00,0x00,0x00,0x00, /* stbl size */ 									// +will be filled later in code
	0x73,0x74,0x62,0x6C, /* "stbl" */

	0x00,0x00,0x00,0x1C, /* stsc size */
	0x73,0x74,0x73,0x63, /* "stsc" */
	0x00,0x00,0x00,0x00, /* stsc flags */
	0x00,0x00,0x00,0x01, /* stsc number of entries */
	0x00,0x00,0x00,0x01, /* stsc first chunk */
	0x00,0x00,0x00,0x01, /* stsc samples per chunk */
	0x00,0x00,0x00,0x01, /* stsc sample description ID */

	0x00,0x00,0x00,0x18, /* stts size */
	0x73,0x74,0x74,0x73, /* "stts" */
	0x00,0x00,0x00,0x00, /* stts flags */
	0x00,0x00,0x00,0x01, /* stts number of entries */
	0x00,0x00,0x00,0x00, /* stts sample count */							// +will be filled later in code
	0x00,0x00,0x00,0x18, /* stts sample duration 18 for 25f, 14 for 30f, 30 for 12.5f*/	// +will be updated later in code
};

u8 qta_vt_stsd[110] = {	
	0x00,0x00,0x00,0x00, /* stsd size */ 									// +will be filled later in code
	 's', 't', 's', 'd', /* "stsd" */
	0x00,0x00,0x00,0x00, /* stsd flags */
	0x00,0x00,0x00,0x01, /* stsd number of entries */
	0x00,0x00,0x00,0x00, /* stsd avc1 table size */ 						// +will be filled later in code
	 'a', 'v', 'c', '1', /* stsd data format = "avc1" */
	0x00,0x00,0x00,0x00, /* stsd reserved */
	0x00,0x00,0x00,0x01, /* stsd reserved & data reference index */
	0x00,0x00,0x00,0x00, /* stsd version & revision level */
	0x00,0x00,0x00,0x00, /* stsd vendor */
	0x00,0x00,0x00,0x00, /* stsd temporal quality */
	0x00,0x00,0x00,0x00, /* stsd spatial quality */
#if (FRAME_CROP_WIDTH == 704)
	0x02,0xC0,0x02,0x40, /* stsd width & height 704*576*/
#else
	0x02,0xD0,0x02,0x40, /* stsd width & height 720*576*/
#endif
	0x00,0x48,0x00,0x00, /* stsd horizontal resolution */
	0x00,0x48,0x00,0x00, /* stsd vertical resolution */
	0x00,0x00,0x00,0x00, /* stsd reserved */
	0x00,0x01,0x00,0x00, /* stsd frame count & Compressor name */
	0x00,0x00,0x00,0x00, /* Compressor name */
	0x00,0x00,0x00,0x00, /* Compressor name */
	0x00,0x00,0x00,0x00, /* Compressor name */
	0x00,0x00,0x00,0x00, /* Compressor name */
	0x00,0x00,0x00,0x00, /* Compressor name */
	0x00,0x00,0x00,0x00, /* Compressor name */
	0x00,0x00,0x00,0x00, /* Compressor name */
	0x00,0x00,0x00,0x18, /* Compressor name  & depth*/
	0xFF,0xFF,			 /* Color table ID */

	0x00,0x00,0x00,0x00, /* avcC description size*/  						// +will be filled later in code
	 'a', 'v', 'c', 'C', /* "avcC" */
};

u8 qta_vt_stss[16] = {
	0x00,0x00,0x00,0x00, /*stss size*/ 										// +will be filled later in code
	0x73,0x74,0x73,0x73, /* "stss" */
	0x00,0x00,0x00,0x00, /* stss flags */
	0x00,0x00,0x00,0x00  /* stss number of entries */						// +will be filled later in code
};

u8 qta_vt_stco[16]   = {
	0x00,0x00,0x00,0x00, /* stco size */ 									// +will be filled later in code
	0x73,0x74,0x63,0x6F, /* "stco" */
	0x00,0x00,0x00,0x00, /* stco flags */
	0x00,0x00,0x00,0x00  /* stco number of entries */						// +will be filled later in code
};

u8 qta_vt_stsz[20]   = { 
	0x00,0x00,0x00,0x00, /* stsz size */ 									// +will be filled later in code
	0x73,0x74,0x73,0x7A, /* "stsz" */
	0x00,0x00,0x00,0x00, /* stsz flags */
	0x00,0x00,0x00,0x00, /* stsz size default */
	0x00,0x00,0x00,0x00  /* stsz number of entries */						// +will be filled later in code
};

#ifdef SOUND_EN
u8 qta_st[367]   = {
	0x00,0x00,0x00,0x00,  /* trak size */ 									// +will be filled later in code
	0x74,0x72,0x61,0x6B, /* "trak" */

	0x00,0x00,0x00,0x5C, /* tkhd size */
	0x74,0x6B,0x68,0x64, /* "tkhd" */
	0x00,0x00,0x00,0x03, /* tkhd flags */
	0xCE,0xE9,0x0B,0x00, /* tkhd creation time = 01.01.2014 00:00:00 */		// +will be updated later in code
	0xCE,0xE9,0x0B,0x00, /* tkhd modification time = 01.01.2014 00:00:00 */	// +will be updated later in code
	0x00,0x00,0x00,0x02, /* tkhd track ID */
	0x00,0x00,0x00,0x00, /* tkhd reserved */
	0x00,0x00,0x00,0x00, /* tkhd duration */								// +will be filled later in code
	0x00,0x00,0x00,0x00, /* tkhd reserved */
	0x00,0x00,0x00,0x00, /* tkhd reserved */
	0x00,0x00,0x00,0x00, /* tkhd layer & alternate group */
	0x01,0x00,0x00,0x00, /* tkhd volume & reserved */
	0x00,0x01,0x00,0x00, /* tkhd matrix a */
	0x00,0x00,0x00,0x00, /* tkhd matrix b */
	0x00,0x00,0x00,0x00, /* tkhd matrix u */
	0x00,0x00,0x00,0x00, /* tkhd matrix c */
	0x00,0x01,0x00,0x00, /* tkhd matrix d */
	0x00,0x00,0x00,0x00, /* tkhd matrix v */
	0x00,0x00,0x00,0x00, /* tkhd matrix x */
	0x00,0x00,0x00,0x00, /* tkhd matrix y */
	0x40,0x00,0x00,0x00, /* tkhd matrix w */
	0x00,0x00,0x00,0x00, /* tkhd width */
	0x00,0x00,0x00,0x00, /* tkhd height */

	0x00,0x00,0x00,0x00, /* mdia size */ 									// +will be filled later in code
	0x6D,0x64,0x69,0x61, /* "mdia" */

	0x00,0x00,0x00,0x20, /* mdhd size */
	0x6D,0x64,0x68,0x64, /* "mdhd" */
	0x00,0x00,0x00,0x00, /* mdhd flags */
	0xCE,0xE9,0x0B,0x00, /* mdhd creation time = 01.01.2014 00:00:00 */		// +will be updated later in code
	0xCE,0xE9,0x0B,0x00, /* mdhd modification time = 01.01.2014 00:00:00 */	// +will be updated later in code
#define __T (SAMPLING_FREQUENCY)
	(__T>>24)&0xFF,(__T>>16)&0xFF,(__T>>8)&0xFF,__T&0xFF,  /* mdhd time scale = SAMPLING_FREQUENCY */
#undef __T
	0x00,0x00,0x00,0x00, /* mdhd duration */								// +will be filled later in code
	0x00,0x00,0x00,0x00, /* mdhd language & quality */

	0x00,0x00,0x00,0x2C, /* hdlr size */
	0x68,0x64,0x6C,0x72, /* "hdlr" */
	0x00,0x00,0x00,0x00, /* hdlr flags */
	0x6D,0x68,0x6C,0x72, /* hdlr component type = "mhlr" */
	0x73,0x6f,0x75,0x6e, /* hdlr component subtype = "soun" */
	0x00,0x00,0x00,0x00, /* hdlr component manufacturer */
	0x00,0x00,0x00,0x00, /* hdlr component flags */
	0x00,0x00,0x00,0x00, /* hdlr component flags mask */
	 'S', 'o', 'u', 'n', /* hdlr component name = "SoundHandler" */
	 'd', 'H', 'a', 'n',
	 'd', 'l', 'e', 'r',

	0x00,0x00,0x00,0x00, /* minf size */									// +will be filled later in code
	0x6D,0x69,0x6E,0x66, /* "minf" */

	0x00,0x00,0x00,0x10, /* smhd size */
	0x73,0x6D,0x68,0x64, /* "smhd" */
	0x00,0x00,0x00,0x00, /* smhd flags */
	0x00,0x00,0x00,0x00, /* smhd balance & reserved */

	0x00,0x00,0x00,0x24, /* dinf size */
	0x64,0x69,0x6E,0x66, /* "dinf" */
	0x00,0x00,0x00,0x1C, /* dref size */
	0x64,0x72,0x65,0x66, /* "dref" */
	0x00,0x00,0x00,0x00, /* dref flags */
	0x00,0x00,0x00,0x01, /* dref number of entries */
	0x00,0x00,0x00,0x0C, /* size */
	0x75,0x72,0x6C,0x20, /* "url " */
	0x00,0x00,0x00,0x01, /* flags */

	0x00,0x00,0x00,0x00, /* stbl size */ 									// +will be filled later in code
	0x73,0x74,0x62,0x6C, /* "stbl" */

	0x00,0x00,0x00,0x5B, /* stsd size */
	 's', 't', 's', 'd', /* "stsd" */
	0x00,0x00,0x00,0x00, /* stsd flags */
	0x00,0x00,0x00,0x01, /* stsd number of entries */
	0x00,0x00,0x00,0x4B, /* stsd mp4a table size */
	 'm', 'p', '4', 'a', /* stsd data format = "mp4a" */
	0x00,0x00,0x00,0x00, /* stsd reserved */
	0x00,0x00,0x00,0x01, /* stsd reserved & data reference index */
	0x00,0x00,0x00,0x00, /* stsd version & revision level */
	0x00,0x00,0x00,0x00, /* stsd vendor */
	0x00,0x01,0x00,0x10, /* stsd number of channels & sample size */
	0x00,0x00,0x00,0x00, /* stsd compression ID & packet size */
#define __T (SAMPLING_FREQUENCY)
    (__T>>8)&0xFF,__T&0xFF, 0x00, 0x00,  /* stsd audioSampleRate = SAMPLING_FREQUENCY */
#undef __T
	0x00,0x00,0x00,0x27, /* esds size */
	 'e', 's', 'd', 's', /* "esds" */
	0x00,0x00,0x00,0x00, /* version */
	0x03,0x19,0x00,0x00, /* esds tag type, size and id */
	0x00,0x04,0x11,0x40, /* esds flag,  decoder config descriptor tag, tag size, MPEG4 audio*/
	0x15,0x00,0x06,0x00, /* audio stream, buffersize DB */
	0x00,0x00,0xFA,0x00, /* max bitrate 64000*/
	0x00,0x00,0xFA,0x00, /* avg bitrate 64000*/
	0x05,0x02,0x14,0x08, /* decoder specific info description */
	0x06,0x01,0x02,		 /* sl descriptor tag */

	0x00,0x00,0x00,0x18, /* stts size */
	 's', 't', 't', 's', /* "stts" */
	0x00,0x00,0x00,0x00, /* stts flags */
	0x00,0x00,0x00,0x01, /* stts number of entries */
	0x00,0x00,0x00,0x00, /* stts sample count */							// +will be filled later in code
#define __T (SAMPLES_PER_CHUNK)  /* stts sample duration */
	(__T>>24)&0xFF,(__T>>16)&0xFF,(__T>>8)&0xFF,__T&0xFF,
#undef __T
};

u8 qta_st_stsc[16] = {
	0x00,0x00,0x00,0x00, /* stsc size */									// +will be filled later in code
	 's', 't', 's', 'c', /* "stsc" */
	0x00,0x00,0x00,0x00, /* stsc flags */
	0x00,0x00,0x00,0x00, /* stsc number of entries */						// +will be filled later in code
};

u8 qta_st_stsz[20] = {
	0x00,0x00,0x00,0x00, /* stsz size*/										// +will be filled later in code
	 's', 't', 's', 'z', /* "stsz" */
	0x00,0x00,0x00,0x00, /* stsz flags */
	0x00,0x00,0x00,0x00, /* stsz sample size */
	0x00,0x00,0x00,0x00, /* stsz number of entries */						// +will be filled later in code
};

u8 qta_st_stco[16]   = { 
	0x00,0x00,0x00,0x00, /* stco size */									// +will be filled later in code
	0x73,0x74,0x63,0x6F, /* "stco" */
	0x00,0x00,0x00,0x00, /* stco flags */
	0x00,0x00,0x00,0x00  /* stco Number of entries */						// +will be filled later in code
};
#endif//SOUND_EN



u8 qti_stim[8] = {
	0x00,0x00,0x00,0x34, /* stim size */
	 's', 't', 'i', 'm', /* "stim"  video start time*/
};

u8 qti_avcc[8] = {
	0x00,0x00,0x00,0x00, /* avcc size */									// +will be filled later in code
	 'a', 'v', 'c', 'c', /* "avcc" */
};

u8 qti_ctim[8] = {
	0x00,0x00,0x00,0x00, /* ctim size */									// +will be filled later in code
	 'c', 't', 'i', 'm', /* "ctim" time of video file creation */
};

u8 qti_fps[8] = {
	0x00,0x00,0x00,0x0C, /* fps size */
	 'f', 'p', 's', ' ', /* "fps " frames per second*/
};

u8 qti_fhgt[8] = {
	0x00,0x00,0x00,0x0C, /* fhgt size */
	 'f', 'h', 'g', 't', /* "fhgt " frame height*/
};

u8 qti_fwdt[8] = {
	0x00,0x00,0x00,0x0C, /* fwdt size */
	 'f', 'w', 'd', 't', /* "fwdt" frame width*/
};

u8 qti_vsrn[8] = {
	0x00,0x00,0x00,0x0C, /* vsrn size */
	 'v', 's', 'r', 'n', /* "vsrn " video source number*/
};